<input hidden
  class="form-control"
  type="text"
  id="idUsuario"
  name="idUsuario"
  value="<%=req.cookies.User%>">
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/
xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es-Es" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">

  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>Obtener lista XML de autores con Ajax</title>
  <link rel="stylesheet" href="Bootstrap/css/bootstrap.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <style>
    /* Ocultar botón radio */
    input[id^="spoiler"]{
      display: none;
    }
    /* Estilo botón clicable */
    input[id^="spoiler"] + label {
      display: block;
      width: 200px;
      margin: 0 auto;

      color: #01549b;
      cursor: pointer;
      text-align: left;
    }
    /* Estilo botón cuando su INPUT está seleccionado */
    input[id^="spoiler"]:checked + label {
      color: #01549b;

      text-align: left;
    }
    /* Estilo caja SPOILER (inicialmente oculto) */
    input[id^="spoiler"] ~ .spoiler {
      width: 90%;
      height: 0;
      overflow: hidden;
      opacity: 0;
      margin: 10px auto 0;
      text-align: left;

    }
    /* Estilo caja SPOILER cuando su INPUT está seleccionado */
    input[id^="spoiler"]:checked + label + .spoiler{
      height: auto;
      opacity: 1;
      text-align: left;

    }
  </style>
  <div id='oculto' style='display:none;'>
    <form id="formRadio" name="categoria">
      <input type="button" class="btn btn-info" value="-" onclick="ocultar()">
      <br>
      <div class="row">

        <div class="col-md-4"> <input type="radio" name="category" value="Agriculture"> Agricultura<hr></div>
        <div class="col-md-4"><input type="radio" name="category" value="Engineering (General). Civil engineering (General)">Ingenieria en general<hr></div>
        <div class="col-md-4"> <input type="radio" name="category" value="Education"> Educacion<hr></div>

        <div class="col-lg-4"><input type="radio" name="category" value="Fine Arts"> Artes<hr></div>
        <div class="col-lg-4"> <input type="radio" name="category" value="General Works"> publicaciones en general<hr></div>
        <div class="col-lg-4"> <input type="radio" name="category" value="Geography"> Geografia<hr></div>

        <div class="col-lg-4"><input type="radio" name="category" value="History (General) and history of Europe"> Historia general e historia de Europa<hr></div>
        <div class="col-lg-4"><input type="radio" name="category" value="History America"> Historia de america<hr></div>
        <div class="col-lg-4"><input type="radio" name="category" value="Language and Literature"> Lenguaje y literatura<hr></div>

        <div class="col-lg-4"><input type="radio" name="category" value="Law"> leyes<hr></div>
        <div class="col-lg-4"> <input type="radio" name="category" value="Medicine"> Medicina<hr></div>
        <div class="col-lg-4"><input type="radio" name="category" value="Military Science">Ciencias militares<hr></div>

        <div class="col-lg-4"><input type="radio" name="category" value="Music and books on Music"> Música y libros sobre música<hr></div>
        <div class="col-lg-4"> <input type="radio" name="category" value="Naval Science"> Ciencia Naval<hr></div>
        <div class="col-lg-4"><input type="radio" name="category" value="Philosophy"> Filosofia<hr></div>

        <div class="col-lg-4"><input type="radio" name="category" value="Political science"> Ciencias Politicas<hr></div>
        <div class="col-lg-4"> <input type="radio" name="category" value="Science"> Ciencia<hr></div>
        <div class="col-lg-4"><input type="radio" name="category" value="Social Sciences"> Ciencias sociales<hr></div>

        <div class="col-lg-4"><input type="radio" name="category" value="Systems engineering">Ingenieria en sistemas<hr></div>
        <div class="col-lg-4"><input type="radio" name="category" value="Technology (General)">Tecnologia en general<hr></div>

      </div>

    </form>
  </div>

</head>
<body>

<input type="button" class="btn btn-info" id="catego" value="Ver categorias" onclick="mostrar()" disabled>

<br>
<br>

<input type="text" class="form-control"  name="q" placeholder="Buscar en Arxiv" id="homepage-search-input">
<Select id = "DropDown1">

  <Option value ="all:"> Todo </Option>
  <Option value = "ti:"> Título </Option>
  <Option value = "abs:"> Keywords </Option>
  <Option value = "co:"> Abstract </Option>

</Select>
</i>

<button type="button" class="btn btn-primary" onclick="limpiar();spiner();descargaArchivo()">Busqueda Arxiv</button>

<!-- <button type="button" class="btn btn-success" onclick="javascript:limpiar();spiner();callWebService1()">Ver recomendaciones</button>-->

<br>
<br>

<script type="text/javascript">
function mostrar(){
  document.getElementById('oculto').style.display = 'block';
  document.getElementById('catego').style.display = 'none';
}

function viewMoreData(){
  document.getElementById('oculto2').style.display = 'block';
  document.getElementById('vewMore').style.display = 'none';
}
</script>
<script type="text/javascript">
function ocultar(){
  document.getElementById('oculto').style.display = 'none';
  document.getElementById('catego').style.display = 'block';
}
function spiner(){
  $("#resultado_json").append("<i class='fa fa-spinner fa-spin' style='font-size:24px'></i>");
}
</script>

<p id="pRespuesta"></p>
<div id="resultado_json"></div>
<div id="resultado_json2"></div>


</div> <br><br><br><br>
</div>

<script type="text/javascript">
function descargaArchivo() {

  // $("p").empty();
  // Obtener la instancia del objeto XMLHttpRequest
  if(window.XMLHttpRequest) {
    peticionHttp = new XMLHttpRequest();
  }
  else if(window.ActiveXObject) {
    peticionHttp = new ActiveXObject("Microsoft.XMLHTTP");
  }
  // Preparar la funcion de respuesta
  peticionHttp.onreadystatechange = muestraContenido;
  // Realizar peticion HTTP
  var busquedarxiv1 = document.getElementById("homepage-search-input").value;
  var busquedarxiv = busquedarxiv1.replace(/\s/g,"+AND+");
  var par1= 'http://export.arxiv.org/api/query?search_query=';
  var selected = document.getElementById ("DropDown1").value;

  mm= busquedarxiv;
  console.log("Este es el valor del cookie:",mm);
  var concatenacion1= par1+busquedarxiv;
  peticionHttp.open('GET',concatenacion1, true);
  peticionHttp.send(null);
  function muestraContenido() {
    if(peticionHttp.readyState == 4) {
      if(peticionHttp.status == 200) {
        //Creamos el objeto de tipo documento XML
        var documentoXml = peticionHttp.responseXML;
        //Obtenemos la raíz del documento
        var root = documentoXml.getElementsByTagName("feed")[0];
        var tope = root.getElementsByTagName("entry").length;
        //Recorremos todos los elementos Libro del documento
        for(var i = 0; i < tope; i++){
          libro = root.getElementsByTagName("entry")[i];
          title = libro.getElementsByTagName("title")[0].firstChild.nodeValue;
          abstract = libro.getElementsByTagName("summary")[0].firstChild.nodeValue;
          url = libro.getElementsByTagName("id")[0].firstChild.nodeValue;
          published= libro.getElementsByTagName("published")[0].firstChild.nodeValue;
          year= published.substr(-20,4);
          var busqueda = document.getElementById("homepage-search-input").value;
          $("#resultado_json").empty();
          var hoy = new Date();
          var dd = hoy.getDate();
          var mm = hoy.getMonth()+1; //hoy es 0!
          var yyyy = hoy.getFullYear();

          if(dd<10) {
            dd='0'+dd
          }

          if(mm<10) {
            mm='0'+mm
          }

          hoy = dd+'/'+mm+'/'+yyyy;


          number = '';
          volume = '';
          issns = '';
          journal = '';
          editorial = '';
          starpage = '';
          endpage = '';
          pages = '';
          keywords = busquedarxiv;
          cate='General';
          language = 'EN/ES';
          country = '';
          fkIdUser=parseInt(document.getElementById("idUsuario").value);
          var busqueda = document.getElementById("homepage-search-input").value;
          for (var j = 0; j < 10; j++) {
            if (typeof libro.getElementsByTagName("arxiv:comment")[0]!== 'undefined') {
              coment = libro.getElementsByTagName("arxiv:comment")[0].firstChild.nodeValue;

            }
            else {

              var coment= '';


            }

          }
          for (var j = 0; j < 10; j++) {
            if (typeof libro.getElementsByTagName("arxiv:journal_ref")[0]!== 'undefined') {
              coment2 = libro.getElementsByTagName("arxiv:journal_ref")[0].firstChild.nodeValue;

            }
            else {

              var coment2= '';


            }

          }
          for (var j = 0; j < 10; j++) {
            if (typeof libro.getElementsByTagName("arxiv:doi")[0]!== 'undefined') {
              doi = libro.getElementsByTagName("arxiv:doi")[0].firstChild.nodeValue;

            }
            else {

              var doi= '';


            }

          }
          for (var j = 0; j < 10; j++) {
            if (typeof libro.getElementsByTagName("author")[0]!== 'undefined') {

              author = libro.getElementsByTagName("author")[0];
              nombre = author.getElementsByTagName("name")[0].firstChild.nodeValue;
              var nombres= nombre;
              var authorb = nombres.charAt(0);
              textoAuthorDividido = nombres.split(" ");
              numeroPalabras = textoAuthorDividido.length;
              if (numeroPalabras >= 4) {
                nameAuthor = nombres.split(/\s+/, 2);
                //var output = autores.split(/\s+/).pop();
                //output es el apellido del autor
                //nombreA es el nombre del autor
                var output1 = textoAuthorDividido[textoAuthorDividido.length - 2];
                var output12 = textoAuthorDividido[textoAuthorDividido.length - 1];
                var apellido = output1 + ' ' + output12;


              }
              else {
                nameAuthor = nombres.split(/\s+/, 1);
                //var output = autores.split(/\s+/).pop();
                var apellido  = textoAuthorDividido[textoAuthorDividido.length - 1];


              }
              var nombreA0 = (nameAuthor.join(" "));
              var nombreA = nombreA0;

              var authorbibliograpyIEEE = authorb + ' ' + apellido;
              var authorsb = authorbibliograpyIEEE;
              var nombreAuthores=[nombreA];
              var apellidoAuthores=[apellido];
              var apellidoAuthoresISO= apellido.toUpperCase()+' '+nombreA;
              var apellidoAuthoreshardvard= apellido+', '+nombreA.charAt(0)+'.';
            }
            else {

              var nombre= '';


            }
            console.log("author1", nombreA + ' '+apellido);

          }


          for (var j = 0; j < 10; j++) {
            if (typeof libro.getElementsByTagName("author")[1]!== 'undefined') {

              author1 = libro.getElementsByTagName("author")[1];
              nombre1 = author1.getElementsByTagName("name")[0].firstChild.nodeValue;
              var authorb1 = nombre1.charAt(0);
              var textoAuthorDividido1 = nombre1.split(" ");
              var numeroPalabras1 = textoAuthorDividido1.length;


              if (numeroPalabras1 >= 4) {
                nameAuthor1 = nombre1.split(/\s+/, 2);
                //var output = autores.split(/\s+/).pop();
                //apellido1 es el apellido del autor
                //nombreA es el nombre del autor
                var output21 = textoAuthorDividido1[textoAuthorDividido1.length - 2];
                var output22 = textoAuthorDividido1[textoAuthorDividido1.length - 1];
                apellido1 = output21 + ' ' + output22;

              }
              else {
                nameAuthor1 = nombre1.split(/\s+/, 1);
                //var output = autores.split(/\s+/).pop();
                apellido1 = textoAuthorDividido1[textoAuthorDividido1.length - 1];

              }

              nombreA1 = (nameAuthor1.join(" "));
              var authorbibliograpyIEEE1 = authorb1 + ' ' + apellido1;
              var authorsb = authorbibliograpyIEEE + ' ' + 'y ' + ' ' + authorbibliograpyIEEE1;
              var nombreAuthores=[nombreA,nombreA1];
              var apellidoAuthores=[apellido,apellido1];
              var apellidoAuthoresISO= apellido.toUpperCase()+', '+nombreA +';  '+apellido1.toUpperCase()+', '+nombreA1;
              var apellidoAuthoreshardvard= apellido+', '+nombreA.charAt(0)+'.'+apellido1+', '+nombreA1.charAt(0)+'.';
              var nombres= nombre +'; '+nombre1;
              console.log("autor2", nombres);
            }
            else {
              var autor1 = '';
              var authorb1 = '';
              var output1 = '';
              var authorbibliograpyIEEE1 = '';
              var nombreA1 = '';
              var apellido1 = '';
              var nombre1= '';


            }

            console.log("author2", nombreA1 + ' '+apellido1);
          }

          for (var j = 0; j < 10; j++) {
            if (typeof libro.getElementsByTagName("author")[2]!== 'undefined') {

              author2 = libro.getElementsByTagName("author")[2];
              nombre2 = author2.getElementsByTagName("name")[0].firstChild.nodeValue;
              var nombres= nombre +'; '+nombre1+'; '+nombre2;

              var authorb2 = nombre2.charAt(0);
              var textoAuthorDividido2 = nombre2.split(" ");
              var numeroPalabras2 = textoAuthorDividido2.length;


              if (numeroPalabras2 >= 4) {
                nameAuthor2 = nombre2.split(/\s+/, 2);
                //var output = autores.split(/\s+/).pop();
                //apellido2 es el apellido del autor
                //nombreA es el nombre del autor
                var output31 = textoAuthorDividido2[textoAuthorDividido2.length - 2];
                var output32 = textoAuthorDividido2[textoAuthorDividido2.length - 1];
                apellido2 = output31 + ' ' + output32;

              }
              else {
                nameAuthor2 = nombre2.split(/\s+/, 1);
                //var output = autores.split(/\s+/).pop();
                apellido2 = textoAuthorDividido2[textoAuthorDividido2.length - 1];

              }
              nombreA2 = (nameAuthor2.join(" "));
              var authorbibliograpyIEEE2 = authorb2 + ' ' + apellido2;
              var authorsb = authorbibliograpyIEEE + ' ' + ',' + ' ' + authorbibliograpyIEEE1 + ' ' + 'y ' + ' ' + authorbibliograpyIEEE2;
              var nombreAuthores=[nombreA,nombreA1,nombreA2];
              var apellidoAuthores=[apellido,apellido1,apellido2];
              var apellidoAuthoresISO= apellido.toUpperCase()+' '+nombreA +', '+apellido1.toUpperCase()+', '+nombreA1 +';'+apellido2.toUpperCase()+','+nombreA2;
              var apellidoAuthoreshardvard= apellido+', '+nombreA.charAt(0)+'.'+apellido1+', '+nombreA1.charAt(0)+'.'+apellido2+' '+nombreA2.charAt(0)+'.';


            }
            else {
              var autor2 = ' ';
              var authorb2 = '';
              var output2 = '';
              var authorbibliograpyIEEE2 = '';
              var nombreA2 = '';
              var apellido2 = '';
              var nombre2= ' ';
            }
            console.log("author3", nombreA2 + ' '+apellido2);

          }
          for (var j = 0; j < 10; j++) {
            if (typeof libro.getElementsByTagName("author")[3]!== 'undefined') {

              author3 = libro.getElementsByTagName("author")[3];
              nombre3 = author3.getElementsByTagName("name")[0].firstChild.nodeValue;
              var nombres= nombre +'; '+nombre1+'; '+nombre2+'; '+nombre3;

              var authorb3 = nombre3.charAt(0);
              var textoAuthorDividido3 = nombre3.split(" ");
              var numeroPalabras3 = textoAuthorDividido3.length;

              if (numeroPalabras3 >= 4) {
                nameAuthor3 = nombre3.split(/\s+/, 2);
                //var output = autores.split(/\s+/).pop();
                //apellido2 es el apellido del autor
                //nombreA es el nombre del autor
                var output41 = textoAuthorDividido3[textoAuthorDividido3.length - 2];
                var output42 = textoAuthorDividido3[textoAuthorDividido3.length - 1];
                apellido3 = output41 + ' ' + output42;

              }
              else {
                nameAuthor3 = nombre3.split(/\s+/, 1);
                //var output = autores.split(/\s+/).pop();
                apellido3 = textoAuthorDividido3[textoAuthorDividido3.length - 1];

              }
              nombreA3 = (nameAuthor3.join(" "));
              var authorbibliograpyIEEE3 = authorb3 + ' ' + apellido3;
              var authorsb = authorbibliograpyIEEE + ' ' + ',' + ' ' + authorbibliograpyIEEE1 + ', ' + ' ' + authorbibliograpyIEEE2 + ' ' + 'y ' + ' ' + authorbibliograpyIEEE3;
              var nombreAuthores=[nombreA,nombreA1,nombreA2,nombreA3];
              var apellidoAuthores=[apellido,apellido1,apellido2,apellido3];
              var apellidoAuthoresISO= apellido.toUpperCase()+', '+nombreA +' et al.';
              var apellidoAuthoreshardvard= apellido+', '+authorb+'., et al';
            }
            else {
              var autor3 = ' ';
              var authorb3 = '';
              var output3 = '';
              var authorbibliograpyIEEE3 = '';
              var nombreA3 = '';
              var apellido3 = '';
              var nombre3= ' ';
            }
            console.log("author4", nombreA3 + ' '+apellido3);

          }

          var comentary = coment+' '+coment2;
          tamAut=nombres.length;




          muestraHTML('pRespuesta',"<div class='row'>  " +
            "<div class='container'>" +

            "<div class='card'>" +
            "<div >" +
              "<br>"+
            '<a target="_blank" href= '+url+'><h4><b>' + title  +'</b></h4></a>'+
            "<font color='#01549b'><h4><b><u> Coments: </u></b></h4></font><h4><b>" + coment+' '+coment2 + "</h4></b><br>" +
            "<button type='button' class='btn btn-outline-info' data-toggle='collapse' data-target='#demo"+i+"'>Leer más...</button>"+
            "<div id='demo"+i+"' class='collapse in'>"+
            "<font color='#01549b'><h4><b><u>Resumen: </u> </b></h4></font><h4><b>" + "<p ><b><h4><p align='justify'>" + abstract + "</p></p></h4></b></p>" + "</h4></b><br>" +
            "<font color='#01549b'><h4><b><u>Referencia del journal: </u> </b></h4></font><h4><b>" + "<p ><b><h4><p align='justify'>" + coment2 + "</p></p></h4></b></p>" + "</h4></b><br>" +
            "<font color='#01549b'><h4><b><u> Autores: </u></b></h4></font><h4><b>" +nombres+"</h4></b> <br>"+
            "<font color='#01549b'><h4><b><u> DOI: </u></b></h4></font><h4><b>" +doi+"</h4></b> <br>"+
            "<font color='#01549b'><h4><b><u> Fecha de publicación: </u></b></h4></font><h4><b>" +published.substr(-20,10)+"</h4></b> <br>"+
            // "<div align='left'>"+"<input type='checkbox' id='spoiler2' align='left'></input> <label for='spoiler2' align='left'><p id='spoiler2' align='left'><h4><u>Abstract</p></h4></u></label> <div class='spoiler'>"+"<p ><b><h4><p align='justify'>" + abstract + "</p></p></h4></b></p>" +"</div>"+"</div>"+

            <!-- Button trigger modal -->
              "<button type='button' class='btn btn-primary mb-2' data-toggle='modal' data-target='#exampleModal"+i+"'> Bibliografía </button>"+

              <!-- Modal -->
              "<div class='modal fade' id='exampleModal"+i+"' tabindex='-1' role='dialog' aria-labelledby='exampleModalLabel"+i+"' aria-hidden='true'>"+
              "<div class='modal-dialog modal-lg' role='document'>"+
              "<div class='modal-content'>"+
              "<div class='modal-header'>"+
              "<h5 class='modal-title' id='exampleModalLabel"+i+"'>Bibliografía</h5>"+
              "<button type='button' class='close' data-dismiss='modal' aria-label='Close'>"+
              "<span aria-hidden='true'>&times;</span>"+
              "</button>"+
              "</div>"+
              "<div class='modal-body'>"+

              "<label for='apa' class='col-2 col-form-label'><h5>APA</h5></label>"+
              "<div class='col-12'>"+
              "<p ALIGN='justify'>"+ apellidoAuthoreshardvard + ".("+year+ ")."+title +".<i> "+journal+" </i>,<i>"+ volume+ "</i>( "+number+" ),"+pages + ". Recuperado de "+'<a target="_blank" href="'+ url +'">'+url+'</a>'+"</p>"+
              "</div> " +

              "<label for='ieee' class='col-2 col-form-label'><h5>IEEE</h5></label>"+
              "<div class='col-12'>"+
              "<p ALIGN='justify'>" + authorsb + ',' + title + ', ' + "<i>" + journal + "</i>" + ', vol.' + volume + ', no.' + number + ', pp.' + pages + ',' + ' ' +  year +"</p>" +

              "</div>" +
              "<label for='iso' class='col-2 col-form-label'><h5>ISO 690</h5></label>"+
              "<div class='col-12'>"+
              "<p ALIGN='justify'>" + apellidoAuthoresISO + '(' + year.substr(-20,4) + '), "' + title + '".En: '+"<i>" + journal + "</i>[en línea]." +editorial+ '. V.' + volume + ', no.' + number + ', pp.' + pages + "[consulta:"+hoy+"].Disponible en: "+'<a target="_blank" href="'+ url +'">'+url+'</a>'+ "</p>" +

              "</div>" +
              "<label for='harvard' class='col-2 col-form-label'><h5>Harvard</h5></label>"+
              "<div class='col-12'>"+
              "<p ALIGN='justify'>" + apellidoAuthoreshardvard + '(' + year.substr(-20,4) + '), "' + title  +'"'+".<i>" +journal + "</i>,"+volume+ "("+number+"),pp."+pages+ ".Disponible en: "+'<a href="'+ url +'">'+url+'</a>'+"[Consultado:"+hoy+"]</p>"+
              "</div>"+
              "<div class='modal-footer'>"+
              "<button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>"+
              "</div></div>"+
              "</div> " +
              "</div> " +



              "<br><br><br></div>" +

              "<form action='/GuardarArticulo/crearArticuloQuemado' method='post'>" +
              "<input hidden type='text' name='title' value='" + title + "'>" +
              "<input hidden type='text' name='country' value='" + country + "'>" +
              "<input hidden type='text' name='number' value='" + number + "'>" +
              "<input hidden type='text' name='volume' value='" + volume + "'>" +
              "<input hidden type='text' name='issns' value='" + issns + "'>" +
              "<input hidden type='text' name='language' value='" + language + "'>" +
              "<input hidden type='text' name='year' value='" + year + "'>" +
              "<input hidden type='text' name='journal' value='" + journal + "'>" +
              "<input hidden type='text' name='editorial' value='" + editorial + "'>" +
              "<input hidden type='text' name='abstract' value='" + abstract + "'>" +
              "<input hidden type='text' name='keywords' value='" + keywords + "'>" +
              "<input hidden type='text' name='doi' value='" + doi + "'>" +
              "<input hidden type='text' name='link' value='" + url + "'>" +
              "<input hidden type='text' name='authores' value='" + nombres + "'>" +
              "<input hidden type='text' name='nombreAuthores' value='" + nombreA + "'>" +
              "<input hidden type='text' name='apellidoAuthores' value='" + apellido + "'>" +
              "<input hidden type='text' name='nombreAuthores1' value='" + nombreA1 + "'>" +
              "<input hidden type='text' name='apellidoAuthores1' value='" + apellido1 + "'>" +
              "<input hidden type='text' name='nombreAuthores2' value='" + nombreA2 + "'>" +
              "<input hidden type='text' name='apellidoAuthores2' value='" + apellido2 + "'>" +
              "<input hidden type='text' name='nombreAuthores3' value='" + nombreA3 + "'>" +
              "<input hidden type='text' name='apellidoAuthores3' value='" + apellido3 + "'>" +
              "<input hidden type='text' name='fkIdUser' value='" + parseInt(fkIdUser) + "'>" +
              "<input hidden type='text' name='busqueda' value='" + busqueda + "'>" +
              "<input hidden type='number' name='numero_autores' value='" + tamAut + "'>" +
              "<input hidden type='text' name='category' value='" + cate + "'>" +
              "<input hidden type='text' name='pages' value='" + pages + "'>" +

              "<button class='btn btn-outline-success'>Guardar en mi biblioteca</button>" +

              "</div> " +
              "</form>"+

              "</div></div>"
            );


          }

        }
      }
    }
    function muestraHTML(id, texto){
      if(document.getElementById){
        document.getElementById(id).innerHTML += texto;
      }

    }

  }
  function limpiar(){
    var resultados = document.getElementById("pRespuesta");
    resultados.innerHTML='';
      $("#resultado_json").empty();

  }
  window.onload = descargaArchivo;
</script>

<p id="pRespuesta"></p>

<!- -------------BUSQUEDA DE MR DLIB--------------->

<div id="resultado_json">
  <script type="text/javascript">

    function webServiceResult1(data) {
      var busqueda = document.getElementById("homepage-search-input").value;

      $("#resultado_json").empty();
      var hoy = new Date();
      var dd = hoy.getDate();
      var mm = hoy.getMonth()+1; //hoy es 0!
      var yyyy = hoy.getFullYear();

      if(dd<10) {
        dd='0'+dd
      }

      if(mm<10) {
        mm='0'+mm
      }

      hoy = dd+'/'+mm+'/'+yyyy;

      for (i = 0; i <+data.data.length; i++) {

        title = data.data[i].title;
        number = '';
        volume = '';
        issns = '';
        journal = '';
        editorial =''
        doi='';
        publisher = data.data[i].publisher; //poner un if
        year = data.data[i].datePublished; //poner un if
        starpage = '';
        endpage = '';
        pages = '';
        keywords = busqueda;
        cate= data.data[i].topics[0]; //poner un if
        abstract= data.data[i].description;
        language = 'EN/ES';
        country = '';
        var url = data.data[i].downloadUrl;
        fkIdUser=parseInt(document.getElementById("idUsuario").value);
        var busqueda = document.getElementById("homepage-search-input").value;

        for (var j = 0; j < 10; j++) {
          if (typeof data.data[i].authors[0] !== 'undefined') {

            var autorHtml = data.data[i].authors[0];
            var autores = autorHtml;
            var authorb = autores.charAt(0);
            textoAuthorDividido = autorHtml.split(" ");
            numeroPalabras = textoAuthorDividido.length;
            if (numeroPalabras >= 4) {
              nameAuthor = autores.split(/\s+/, 2);
//var output = autores.split(/\s+/).pop();
//output es el apellido del autor
//nombreA es el nombre del autor
              var output1 = textoAuthorDividido[textoAuthorDividido.length - 2];
              var output12 = textoAuthorDividido[textoAuthorDividido.length - 1];
              var apellido = output1 + ' ' + output12;


            }
            else {
              nameAuthor = autores.split(/\s+/, 1);
//var output = autores.split(/\s+/).pop();
              var apellido  = textoAuthorDividido[textoAuthorDividido.length - 1];


            }
            var nombreA0 = (nameAuthor.join(" "));
            var nombreA = nombreA0;

            var authorbibliograpyIEEE = authorb + ' ' + apellido;
            var authorsb = authorbibliograpyIEEE;
            var nombreAuthores=[nombreA];
            var apellidoAuthores=[apellido];
            var apellidoAuthoresISO=apellido.toUpperCase()+', '+nombreA;
            var apellidoAuthoreshardvard=apellido+', '+nombreA.charAt(0)+'.';
          }
          console.log("author1", nombreA + apellido);


        }

        for (var j = 0; j < 10; j++) {
          if (typeof data.data[i].authors[1] !== 'undefined') {
            var autor1 = data.data[i].authors[1];
            var autores = autorHtml + '; '+autor1;
            var authorb1 = autor1.charAt(0);
            var textoAuthorDividido1 = autor1.split(" ");
            var numeroPalabras1 = textoAuthorDividido1.length;


            if (numeroPalabras1 >= 4) {
              nameAuthor1 = autor1.split(/\s+/, 2);
//var output = autores.split(/\s+/).pop();
//apellido1 es el apellido del autor
//nombreA es el nombre del autor
              var output21 = textoAuthorDividido1[textoAuthorDividido1.length - 2];
              var output22 = textoAuthorDividido1[textoAuthorDividido1.length - 1];
              apellido1 = output21 + ' ' + output22;

            }
            else {
              nameAuthor1 = autor1.split(/\s+/, 1);
//var output = autores.split(/\s+/).pop();
              apellido1 = textoAuthorDividido1[textoAuthorDividido1.length - 1];

            }
            nombreA1 = (nameAuthor1.join(" "));
            var authorbibliograpyIEEE1 = authorb1 + ' ' + apellido1;
            var authorsb = authorbibliograpyIEEE + ' ' + 'y ' + ' ' + authorbibliograpyIEEE1;
            var nombreAuthores=[nombreA,nombreA1];
            var apellidoAuthores=[apellido,apellido1];
            var apellidoAuthoresISO=apellido.toUpperCase()+', '+nombreA+' '+apellido1.toUpperCase()+', '+nombreA1;
            var apellidoAuthoreshardvard=apellido+', '+nombreA.charAt(0)+'. '+apellido1+', '+nombreA1.charAt(0)+'.';

          }

          else {
            var autor1 = '';
            var authorb1 = '';
            var output1 = '';
            var authorbibliograpyIEEE1 = '';
            var nombreA1 = '';
            var apellido1 = '';


          }

        }

        for (var j = 0; j < 10; j++) {
          if (typeof data.data[i].authors[2] !== 'undefined') {
            var autor2 = data.data[i].authors[2];
            var autores = autorHtml + '; ' + autor1 + '; '+ autor2;
            var authorb2 = autor2.charAt(0);
            var textoAuthorDividido2 = autor2.split(" ");
            var numeroPalabras2 = textoAuthorDividido2.length;


            if (numeroPalabras2 >= 4) {
              nameAuthor2 = autor2.split(/\s+/, 2);
//var output = autores.split(/\s+/).pop();
//apellido2 es el apellido del autor
//nombreA es el nombre del autor
              var output31 = textoAuthorDividido2[textoAuthorDividido2.length - 2];
              var output32 = textoAuthorDividido2[textoAuthorDividido2.length - 1];
              apellido2 = output31 + ' ' + output32;

            }
            else {
              nameAuthor2 = autor2.split(/\s+/, 1);
//var output = autores.split(/\s+/).pop();
              apellido2 = textoAuthorDividido2[textoAuthorDividido2.length - 1];

            }
            nombreA2 = (nameAuthor2.join(" "));
            var authorbibliograpyIEEE2 = authorb2 + ' ' + apellido2;
            var authorsb = authorbibliograpyIEEE + ' ' + ',' + ' ' + authorbibliograpyIEEE1 + ' ' + 'y ' + ' ' + authorbibliograpyIEEE2;
            var nombreAuthores=[nombreA,nombreA1,nombreA2];
            var apellidoAuthores=[apellido,apellido1,apellido2];
            var apellidoAuthoresISO= apellido.toUpperCase()+' '+nombreA +'  '+apellido1.toUpperCase()+' '+nombreA1 +' '+apellido2.toUpperCase()+' '+nombreA2;
            var apellidoAuthoreshardvard= apellido+', '+nombreA.charAt(0)+'.'+apellido1+', '+nombreA1.charAt(0)+'.'+apellido2+' '+nombreA2.charAt(0)+'.';
          }
          else {
            var autor2 = ' ';
            var authorb2 = '';
            var output2 = '';
            var authorbibliograpyIEEE2 = '';
            var nombreA2 = '';
            var apellido2 = '';
          }

        }

        for (var j = 0; j < 10; j++) {
          if (typeof data.data[i].authors[3] !== 'undefined') {
            var autor3 = data.data[i].authors[1];
            var autores = autorHtml + '; ' + autor1 + '; ' + autor2 + '; ' + autor3;
            var authorb3 = autor3.charAt(0);
            var textoAuthorDividido3 = autor3.split(" ");
            var numeroPalabras3 = textoAuthorDividido3.length;

            if (numeroPalabras3 >= 4) {
              nameAuthor3 = autor3.split(/\s+/, 2);
//var output = autores.split(/\s+/).pop();
//apellido2 es el apellido del autor
//nombreA es el nombre del autor
              var output41 = textoAuthorDividido3[textoAuthorDividido3.length - 2];
              var output42 = textoAuthorDividido3[textoAuthorDividido3.length - 1];
              apellido3 = output41 + ' ' + output42;

            }
            else {
              nameAuthor3 = autor3.split(/\s+/, 1);
//var output = autores.split(/\s+/).pop();
              apellido3 = textoAuthorDividido3[textoAuthorDividido3.length - 1];

            }
            nombreA3 = (nameAuthor3.join(" "));
            var authorbibliograpyIEEE3 = authorb3 + ' ' + apellido3;
            var authorsb = authorbibliograpyIEEE + ' ' + ',' + ' ' + authorbibliograpyIEEE1 + ', ' + ' ' + authorbibliograpyIEEE2 + ' ' + 'y ' + ' ' + authorbibliograpyIEEE3;
            var nombreAuthores=[nombreA,nombreA1,nombreA2,nombreA3];
            var apellidoAuthores=[apellido,apellido1,apellido2,apellido3];
            var apellidoAuthoresISO= apellido.toUpperCase()+', '+nombreA +' et al';
            var apellidoAuthoreshardvard= apellido+', '+authorb+'., et al.';
          }
          else {
            var autor3 = ' ';
            var authorb3 = '';
            var output3 = '';
            var authorbibliograpyIEEE3 = '';
            var nombreA3 = '';
            var apellido3 = '';
          }



        }
        tamAut=nombreAuthores.length;
        tamAutap=apellidoAuthores.length;
        console.log("autores", authorsb,tamAut,tamAutap);
        console.log("autoreswkd:", nombreA + " "+apellido+ " "+ nombreA1 +  " "+apellido1+  " "+nombreA2 +  " "+apellido2+ " "+ nombreA3 + " "+ apellido3);


        for (var j = 0; j < 10; j++) {
          if (data.data[i].downloadUrl[j] !== 'undefined') {

            var urlHtml = devolverHtmlUrl(data.data[i].downloadUrl[0].value);
//var url = data.data[i].downloadUrl[0].value;
          }
        }


        var imprimir =
          "<div style='width: 1000px;' class='card my-2'>" +
          "<div >" +
          "<b></b><br>" +"<a href=" +url+"><h4><b>" + title  +"</b></h4></a>"+
          "<font color='#01549b'><h4><b> Editor:</b></h4></font><h4><b>" + publisher + "</b></h4><br>" +
          "<button type='button' class='btn btn-outline-info' data-toggle='collapse' data-target='#demo"+i+"'>Leer más...</button>"+
          "<div id='demo"+i+"' class='collapse in'>"+
          "<font color='#01549b'><h4><b> Resumen:</b></h4></font>" + "<h4><b><p align='justify'>" + abstract + "</h4></b></p>" +
          // "<font color='#01549b'><h4><b> Keywords:</b></h4></font><h4><b>" + keywords + "</h4></b><br>" +
          //"<font color='#01549b'><h4><b> Category:</b></h4></font><h4><b>"+cate + "</h4></b><br>" +
          "<font color='#01549b'><h4><b> Autores: </b></h4></font><h4><b>" + autorHtml + "</h4><br><h4><b>" +
          autor1 + "</h4></b><br><h4><b>" + autor2 + "</h4></b><br><h4><b>" + autor3 + "</h4></b><br><h4><b>" +
          // "<div class='row'></b>" +


          <!-- Button trigger modal -->
          "<button type='button' class='btn btn-primary' data-toggle='modal' data-target='#exampleModal"+i+"'> Bibliografía </button>"+

          <!-- Modal -->
          "<div class='modal fade' id='exampleModal"+i+"' tabindex='-1' role='dialog' aria-labelledby='exampleModalLabel"+i+"' aria-hidden='true'>"+
          "<div class='modal-dialog modal-lg' role='document'>"+
          "<div class='modal-content'>"+
          "<div class='modal-header'>"+
          "<h5 class='modal-title' id='exampleModalLabel"+i+"'>Bibliografía</h5>"+
          "<button type='button' class='close' data-dismiss='modal' aria-label='Close'>"+
          "<span aria-hidden='true'>&times;</span>"+
          "</button>"+
          "</div>"+
          "<div class='modal-body'>"+

          "<label for='apa' class='col-2 col-form-label'><h4>APA</h4></label>"+
          "<div class='col-12'>"+
          "<p ALIGN='justify'>"+ apellidoAuthoreshardvard + ".("+year+ ")."+title +".<i> "+journal+" </i>,<i>"+ volume+ "</i>( "+number+" ),"+pages +". Recuperado de "+'<a target="_blank" href="'+ url +'">'+url+'</a>'+"</p>"+
          "</div> " +

          "<label for='ieee' class='col-2 col-form-label'><h4>IEEE</h4></label>"+
          "<div class='col-12'>"+
          "<p ALIGN='justify'>" + authorsb + ',' + title + ', ' + "<i>" + journal + "</i>" + ', vol.' + volume + ', no.' + number + ', pp.' + pages + ',' + ' ' +  year + "</p>" +

          "</div>" +
          "<label for='iso' class='col-2 col-form-label'><h4>ISO</h4></label>"+
          "<div class='col-12'>"+
          "<p ALIGN='justify'>" + apellidoAuthoresISO + '(' + year.substr(-20,4) + '), "' + title + '".En: '+"<i>" + journal + "</i>[en línea]." + '. V.' + volume + ', no.' + number + ', pp.' + pages + "[consulta:"+hoy+"].Disponible en: "+'<a target="_blank" href="'+ url +'">'+url+'</a>'+ "</p>" +

          "</div>" +
          "<label for='harvard' class='col-2 col-form-label'><h4>Harvard</h4></label>"+
          "<div class='col-12'>"+
          "<p ALIGN='justify'>" + apellidoAuthoreshardvard + '(' + year.substr(-20,4) + '), "' + title  +'"'+".<i>" +journal + "</i>,"+volume+ "("+number+"),pp."+pages+ ".Disponible en: "+'<a target="_blank" href="'+ url +'">'+url+'</a>'+"[Consultado:"+hoy+"]</p>"+
          "</div>"+
          "<div class='modal-footer'>"+
          "<button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>"+
          "</div></div>"+
          "</div> " +
          "</div> " +
          "</div> " +

          ////////////////////////////////////////////////////////////

          "<form action='/GuardarArticulo/crearArticuloQuemado' method='post'>" +
          "<input hidden type='text' name='title' value='" + title + "'>" +
          "<input hidden type='text' name='country' value='" + country + "'>" +
          "<input hidden type='text' name='number' value='" + number + "'>" +
          "<input hidden type='text' name='volume' value='" + volume + "'>" +
          "<input hidden type='text' name='issns' value='" + issns + "'>" +
          "<input hidden type='text' name='language' value='" + language + "'>" +
          "<input hidden type='text' name='year' value='" + year + "'>" +
          "<input hidden type='text' name='journal' value='" + journal + "'>" +
          "<input hidden type='text' name='editorial' value='" + editorial + "'>" +
          "<input hidden type='text' name='abstract' value='" + abstract + "'>" +
          "<input hidden type='text' name='keywords' value='" + keywords + "'>" +
          "<input hidden type='text' name='doi' value='" + doi + "'>" +
          "<input hidden type='text' name='link' value='" + url + "'>" +
          "<input hidden type='text' name='busqueda' value='" + busqueda + "'>" +
          "<input hidden type='text' name='authores' value='" + autores + "'>" +
          "<input hidden type='text' name='nombreAuthores' value='" + nombreA + "'>" +
          "<input hidden type='text' name='apellidoAuthores' value='" + apellido + "'>" +
          "<input hidden type='text' name='nombreAuthores1' value='" + nombreA1 + "'>" +
          "<input hidden type='text' name='apellidoAuthores1' value='" + apellido1 + "'>" +
          "<input hidden type='text' name='nombreAuthores2' value='" + nombreA2 + "'>" +
          "<input hidden type='text' name='apellidoAuthores2' value='" + apellido2 + "'>" +
          "<input hidden type='text' name='nombreAuthores3' value='" + nombreA3 + "'>" +
          "<input hidden type='text' name='apellidoAuthores3' value='" + apellido3 + "'>" +
          "<input hidden type='text' name='fkIdUser' value='" + parseInt(fkIdUser) + "'>" +
          "<input hidden type='number' name='numero_autores' value='" + tamAut + "'>" +
          "<input hidden type='text' name='category' value='" + cate + "'>" +
          "<input hidden type='text' name='pages' value='" + pages + "'>" +

          "<button class='btn btn-outline-success'>Guardar en biblioteca</button>" +

          "</div> " +
          "</form>"+ "<br><br>"+
          "</div> "


        $("#resultado_json").append($(imprimir));

        /* title = $("#resultado_json").append("Titulo: " + data.records[i].title + "<br>");
         number= $("#resultado_json").append("Numero: " + data.records[i].number + "<br>");*/

      }

    }


    function devolverHtmlUrl(arregloUrl){
      console.log("Arreglo Url: ",arregloUrl)

      htmlURL = '<a href= '+arregloUrl+'> ver PDF </a>'

      htmlURL = htmlURL +  '</ul>'
      console.log("HTML URL",htmlURL)
      return htmlURL
    }

    // Llamada al webservice
    function callWebService1()
    {
      var busqueda = document.getElementById("homepage-search-input").value;
      var var1= "https://core.ac.uk/api-v2/articles/search/";
      var var2= "?page=1&pageSize=10&metadata=true&fulltext=false&citations=false&similar=false&duplicate=false&urls=false&faithfulMetadata=false&apiKey=7scnV9e3mTBKqirNjPlUO8whkZC1bxaA";
      mm= busqueda;
      console.log("Este es el valor del cookie:",mm);
      var concatenacion= var1+busqueda+var2;
      console.log("la url es:"+concatenacion);
      try {


        $.ajax({
            url: concatenacion,

            type: 'GET',//tipo de petición
            dataType: 'json', //tipo de datos
            //jsonpCallback: 'envoltorio',  //nombre de la funcion que envuelve la respuesta
            error: function(xhr, status, error) {
              alert("error");
            },
            success: function(msg) { webServiceResult1(msg) }
          }
        );
      }

      catch (err)
      {
        alert(err);
      }
    }


  </script>
</div>

</body>
</html>
